From a56b4e4c8786793b7abf61f5aed87a35fdaa3725 Mon Sep 17 00:00:00 2001
From: Daniel Johansson <1911831+djohansson@users.noreply.github.com>
Date: Wed, 18 Feb 2026 15:17:23 +0100
Subject: [PATCH 2/2] fix implicit ANSI code under UNICODE define

---
 layers/chassis/dispatch_object_manual.cpp         | 2 +-
 layers/error_message/logging.cpp                  | 2 +-
 layers/layer_options.cpp                          | 4 ++--
 layers/sync/sync_validation.cpp                   | 2 +-
 layers/vk_layer_config.cpp                        | 6 +++---
 layers/vulkan/generated/vk_function_pointers.cpp  | 4 ++--
 scripts/generators/function_pointers_generator.py | 4 ++--
 7 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/layers/chassis/dispatch_object_manual.cpp b/layers/chassis/dispatch_object_manual.cpp
index 1bd8c47..29956f8 100644
--- a/layers/chassis/dispatch_object_manual.cpp
+++ b/layers/chassis/dispatch_object_manual.cpp
@@ -581,7 +581,7 @@ static Device *GetDeviceFromKey(void *key) {
             "destroyed prior to atexit()\n\n";
         printf("%s", error);
 #ifdef VK_USE_PLATFORM_WIN32_KHR
-        OutputDebugString(error);
+        OutputDebugStringA(error);
 #endif
         // last_device is later dereferenced and the user **will** crash soon. We purposefully crash here to ensure that the warning
         // is printed (and a stacktrace points them here first).
diff --git a/layers/error_message/logging.cpp b/layers/error_message/logging.cpp
index 7129db7..a111c1a 100644
--- a/layers/error_message/logging.cpp
+++ b/layers/error_message/logging.cpp
@@ -813,7 +813,7 @@ VKAPI_ATTR VkBool32 VKAPI_CALL MessengerWin32DebugOutputMsg(VkDebugUtilsMessageS
     [[maybe_unused]] const char *cstr = msg_buffer_str.c_str();
 
 #ifdef VK_USE_PLATFORM_WIN32_KHR
-    OutputDebugString(cstr);
+    OutputDebugStringA(cstr);
 #endif
 
     return false;
diff --git a/layers/layer_options.cpp b/layers/layer_options.cpp
index ba92b6a..9a7fcbe 100644
--- a/layers/layer_options.cpp
+++ b/layers/layer_options.cpp
@@ -606,7 +606,7 @@ static void ProcessDebugReportSettings(ConfigAndEnvSettings *settings_data, VkuL
     // Default
     std::vector<std::string> debug_actions_list = {"VK_DBG_LAYER_ACTION_DEFAULT", "VK_DBG_LAYER_ACTION_LOG_MSG"};
 #ifdef WIN32
-    // For Windows, enable message logging AND OutputDebugString
+    // For Windows, enable message logging AND OutputDebugStringA
     debug_actions_list.push_back("VK_DBG_LAYER_ACTION_DEBUG_OUTPUT");
 #endif  // WIN32
 
@@ -732,7 +732,7 @@ static void ProcessDebugReportSettings(ConfigAndEnvSettings *settings_data, VkuL
             const char *cstr = tmp.c_str();
             printf("%s", cstr);
 #ifdef VK_USE_PLATFORM_WIN32_KHR
-            OutputDebugString(cstr);
+            OutputDebugStringA(cstr);
 #endif
 #ifdef VK_USE_PLATFORM_ANDROID_KHR
             __android_log_print(ANDROID_LOG_INFO, "VALIDATION", "%s", cstr);
diff --git a/layers/sync/sync_validation.cpp b/layers/sync/sync_validation.cpp
index 000347e..878c7e0 100644
--- a/layers/sync/sync_validation.cpp
+++ b/layers/sync/sync_validation.cpp
@@ -61,7 +61,7 @@ void SyncValidator::DebugCapture() {
         const std::string report = stats.CreateReport();
         std::cout << report;
 #ifdef VK_USE_PLATFORM_WIN32_KHR
-        OutputDebugString(report.c_str());
+        OutputDebugStringA(report.c_str());
 #endif
     }
 }
diff --git a/layers/vk_layer_config.cpp b/layers/vk_layer_config.cpp
index 795f307..41ed6f6 100644
--- a/layers/vk_layer_config.cpp
+++ b/layers/vk_layer_config.cpp
@@ -54,12 +54,12 @@ std::string GetEnvironment(const char *variable) {
     const char *output = getenv(variable);
     return output == NULL ? "" : output;
 #elif defined(_WIN32)
-    int size = GetEnvironmentVariable(variable, NULL, 0);
+    int size = GetEnvironmentVariableA(variable, NULL, 0);
     if (size == 0) {
         return "";
     }
     char *buffer = new char[size];
-    GetEnvironmentVariable(variable, buffer, size);
+    GetEnvironmentVariableA(variable, buffer, size);
     std::string output = buffer;
     delete[] buffer;
     return output;
@@ -91,7 +91,7 @@ void SetEnvironment(const char *variable, const char *value) {
 #if !defined(__ANDROID__) && !defined(_WIN32)
     setenv(variable, value, 1);
 #elif defined(_WIN32)
-    SetEnvironmentVariable(variable, value);
+    SetEnvironmentVariableA(variable, value);
 #elif defined(__ANDROID__)
     (void)variable;
     (void)value;
diff --git a/layers/vulkan/generated/vk_function_pointers.cpp b/layers/vulkan/generated/vk_function_pointers.cpp
index cc03c4b..6ab265a 100644
--- a/layers/vulkan/generated/vk_function_pointers.cpp
+++ b/layers/vulkan/generated/vk_function_pointers.cpp
@@ -36,10 +36,10 @@
 typedef HMODULE dl_handle;
 static dl_handle open_library(const char *lib_path) {
     // Try loading the library the original way first.
-    dl_handle lib_handle = LoadLibrary(lib_path);
+    dl_handle lib_handle = LoadLibraryA(lib_path);
     if (lib_handle == NULL && GetLastError() == ERROR_MOD_NOT_FOUND) {
         // If that failed, then try loading it with broader search folders.
-        lib_handle = LoadLibraryEx(lib_path, NULL, LOAD_LIBRARY_SEARCH_DEFAULT_DIRS | LOAD_LIBRARY_SEARCH_DLL_LOAD_DIR);
+        lib_handle = LoadLibraryExA(lib_path, NULL, LOAD_LIBRARY_SEARCH_DEFAULT_DIRS | LOAD_LIBRARY_SEARCH_DLL_LOAD_DIR);
     }
     return lib_handle;
 }
diff --git a/scripts/generators/function_pointers_generator.py b/scripts/generators/function_pointers_generator.py
index 31d75a5..64d280d 100644
--- a/scripts/generators/function_pointers_generator.py
+++ b/scripts/generators/function_pointers_generator.py
@@ -110,10 +110,10 @@ void ResetAllExtensions();
 typedef HMODULE dl_handle;
 static dl_handle open_library(const char *lib_path) {
     // Try loading the library the original way first.
-    dl_handle lib_handle = LoadLibrary(lib_path);
+    dl_handle lib_handle = LoadLibraryA(lib_path);
     if (lib_handle == NULL && GetLastError() == ERROR_MOD_NOT_FOUND) {
         // If that failed, then try loading it with broader search folders.
-        lib_handle = LoadLibraryEx(lib_path, NULL, LOAD_LIBRARY_SEARCH_DEFAULT_DIRS | LOAD_LIBRARY_SEARCH_DLL_LOAD_DIR);
+        lib_handle = LoadLibraryExA(lib_path, NULL, LOAD_LIBRARY_SEARCH_DEFAULT_DIRS | LOAD_LIBRARY_SEARCH_DLL_LOAD_DIR);
     }
     return lib_handle;
 }
-- 
2.52.0.windows.1

